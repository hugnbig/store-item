function isSuppWebsocket(){var t,e,o=navigator.userAgent.toLowerCase(),n={ie:{reg:/msie ([\d.]+)/,support:10},firefox:{reg:/firefox\/([\d.]+)/,support:4},chrome:{reg:/chrome\/([\d.]+)/,support:4},opera:{reg:/opera.([\d.]+)/,support:10},safari:{reg:/version\/([\d.]+).*safari/,support:5}};for(t in n){if(e=n[t].reg.exec(o)){var c=e[1].split(".");return 1*c[0]>=n[t].support}if("ActiveXObject"in window)return!0}return!1}window.$=window.$||{},window.$.insertStyle=window.$.insertStyle||function(t){try{style=document.createStyleSheet(),style.cssText=t}catch(e){style=document.createElement("style"),style.type="text/css",style.textContent=t,document.getElementsByTagName("HEAD").item(0).appendChild(style)}},window.mchat=window.mchat||{},mchat.host="http://chat.meilele.com",/test\.meilele\.com/.test(location.host)&&(mchat.host="http://chata.meilele.com"),function(){var t=document.getElementById("INIT_Fchat2");t&&(t.style.display="none")}(),mchat.config&&mchat.config.background_main||(mchat.config={background_main:"http://image.meilele.com/images/201405/1399536980832.png,http://image.meilele.com/images/201405/1399536995592.gif",size_main:"100,200,5,190",background_small:"http://image.meilele.com/images/201405/1401178094439.png,http://image.meilele.com/images/201405/140117892382.gif",size_small:"58,127,5,190",chat_btn:"77,116,0,0",sms_btn:"77,53,0,118",min_btn:"77,20,0,172",cloud_offset:"110,75,110,35",number_offset:"70,8",number2_offset:"24,-1",html:'<div class="FC_btns" style="width: 34px;height: 8px;overflow: hidden;background: url(http://image.meilele.com/mchat/images/bf.gif) 0 0 no-repeat;margin-left: 22px;margin-top:32px;z-index:1499;"></div>'}),mchat.initCss=function(){for(var t in mchat.config)"string"==typeof mchat.config[t]&&(mchat.config[t].indexOf(",")>=0||"background_main"==t||"background_small"==t)&&(mchat.config[t]=mchat.config[t].split(","));mchat.config.background_main[1]=mchat.config.background_main[1]||mchat.config.background_main[0],mchat.config.background_small[1]=mchat.config.background_small[1]||mchat.config.background_small[0],mchat.isFlash=/\.swf/.test(mchat.config.background_main[0].toLowerCase());var e=[];e.push(".FC_hide{height:0px!important;}"),e.push("#Fchat1,#Fchat2{font-size:12px;z-index:1500;position:fixed;_position:absolute;overflow:hidden}"),e.push("#Fchat1{width:"+mchat.config.size_main[0]+"px;height:"+mchat.config.size_main[1]+"px;right:"+mchat.config.size_main[2]+"px;"+(mchat.config.size_main[3]?"top:"+mchat.config.size_main[3]+"px;_top:expression(eval(document.documentElement.scrollTop+"+mchat.config.size_main[3]+"))px;":"")+"}"),mchat.isFlash||e.push("#Fchat1{background:url("+mchat.config.background_main[0]+") 0 0 no-repeat;_background:url("+mchat.config.background_main[1]+") 0 0 no-repeat;}"),e.push(".FC_btns{background-image:url(http://image.meilele.com/images/blank.gif);position:absolute;cursor:pointer;z-index:1501;}"),e.push("#Fchat2{width:"+mchat.config.size_small[0]+"px;height:"+mchat.config.size_small[1]+"px;right:"+mchat.config.size_small[2]+"px;"+(mchat.config.size_small[3]?"top:"+mchat.config.size_small[3]+"px;_top:expression(eval(document.documentElement.scrollTop+"+mchat.config.size_small[3]+"))px;":"")+";background:url("+mchat.config.background_small[0]+") 0 0;_background:url("+mchat.config.background_small[1]+") 0 0;cursor:pointer}"),e.push(".FC_number{width:20px;height:20px;line-height:20px;text-align:center;color:#fff;font-weight:bold;font-family:Arial;border-radius:12px;background:#ff9030;color:#f5e0ce;border:2px solid #f5e0ce;display:none;font-size:14px;}"),e.push(".FC_number2{width:28px;}"),e.push("#FchatMsg{font-family:微软雅黑;display:none;z-index:1500;width:109px;height:66px;border:1px solid #fac3c9;border-radius:6px;background-color: #fff0f1;position: relative;padding:12px;position:fixed;right:"+(mchat.config.cloud_offset[1]||28)+"px; top:"+(mchat.config.cloud_offset[0]||90)+"px;_position:absolute;_top:expression(eval(document.documentElement.scrollTop+"+(mchat.config.cloud_offset[0]||90)+"))px;}"),e.push("#FchatMsg a{font-family:微软雅黑;font-weight:bold;font-size:13px;color:#e5134e}"),e.push("#FchatMsg a:hover{text-decoration:underline;}"),e.push("#FchatMsg.FC_min_msg{right:"+(mchat.config.cloud_offset[3]||3)+"px; top:"+(mchat.config.cloud_offset[2]||90)+"px;_position:absolute;_top:expression(eval(document.documentElement.scrollTop+"+(mchat.config.cloud_offset[2]||90)+"))px;}"),e.push("#FchatMsg .triangle{width:0px;height:0px;position: absolute;*zoom:1;}#FchatMsg .triangle_out{left:54px;top:90px;_top:96px;border-left:11px solid transparent;border-top:11px solid #fac3c9;_border-left-color:tomato;_filter:chroma(color=tomato)}#FchatMsg .triangle_in{left:54px;top:89px;_top:95px;border-left:10px solid transparent;border-top:10px solid #fff0f1;_border-left-color:tomato; _filter:chroma(color=tomato)}#FchatMsg .msg_title{font-size:14px;color:#333;}#FchatMsg .msg_content{font-size:14px;color:#666;font-weight:bold;margin-top:6px;width:119px;height:44px;overflow:hidden;}#FchatMsg .close_btn{float:right;font-size:14px;text-decoration:none;font-weight:normal;margin-right:-6px;font-family:SimSun;color:#666;}#FchatMsg .close_btn:hover{color:#C9033B;}#FchatMsg .faq_list{list-style: none;font-size: 12px;font-weight: normal;padding-bottom: 10px;line-height: 21px;margin-top: 0}#FchatMsg .faq_item{width:119px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}"),e.push("#FchatPoMsg {cursor: pointer;font-family: 微软雅黑;z-index: 1500;width: 108px;border: 1px solid #fac3c9;border-radius: 6px;background-color: #fff0f1;position: relative;padding: 12px;position: fixed;right: 116px;top: 302px;line-height: 20px;display:none;}"),e.push("#FchatPoMsg.FC_min_pomsg{top:246px;right:70px;}"),e.push("#FchatPoMsg .triangle { width: 0; height: 0; position: absolute;}"),e.push("#FchatPoMsg .triangle_out { right: -11px; top: 30px; _top: 96px; border-right: 11px solid transparent; border-top: 11px solid #fac3c9; _border-left-color: tomato; _filter: chroma(color=tomato);}"),e.push("#FchatPoMsg .triangle_in { right: -8px; top: 31px; _top: 96px; border-right: 10px solid transparent; border-top: 10px solid #fff0f1; _border-left-color: tomato; _filter: chroma(color=tomato);}"),e.push("#FchatPoMsg .expr-msg-close{position: absolute;top: -1px;right: -2px;font-size: 16px;display: inline-block; width: 20px; height: 20px;cursor:pointer;}"),e.push("#FchatPoMsg .expr-msg-close:hover{text-decoration:none;}"),$.insertStyle(e.join(""))},mchat.insertDom=function(){$("#Fchat1")[0]&&($("#Fchat1").remove(),$("#Fchat2").remove(),$("#FchatMsg").remove()),mchat.dom1=document.createElement("div"),mchat.dom1.setAttribute("id","Fchat1");var t="";mchat.config.chat_btn&&mchat.config.chat_btn.length&&(t+='<div class="FC_btns" style="width:'+mchat.config.chat_btn[0]+"px;height:"+mchat.config.chat_btn[1]+"px;margin-left:"+mchat.config.chat_btn[2]+"px;margin-top:"+mchat.config.chat_btn[3]+'px;" id="JS_FC_chat" onclick="mchat.openui();return false;"></div>'),mchat.config.sms_btn&&mchat.config.sms_btn.length&&(t+='<div class="FC_btns" style="width:'+mchat.config.sms_btn[0]+"px;height:"+mchat.config.sms_btn[1]+"px;margin-left:"+mchat.config.sms_btn[2]+"px;margin-top:"+mchat.config.sms_btn[3]+'px;" id="JS_FC_click" onclick="mchat.showSmsList();return false;">'+(mchat.config.sms_text?mchat.config.sms_text.replace("{city}",$.cookie("region_name")||"附近"):"")+"</div>"),mchat.config.min_btn&&mchat.config.min_btn.length&&(t+='<div class="FC_btns" style="width:'+mchat.config.min_btn[0]+"px;height:"+mchat.config.min_btn[1]+"px;margin-left:"+mchat.config.min_btn[2]+"px;margin-top:"+mchat.config.min_btn[3]+'px;" id="JS_FC_min" onclick="mchat.hide();return false;"></div>'),mchat.config.number_offset&&mchat.config.number_offset.length&&(t+='<div class="FC_btns FC_number" style="margin-left:'+mchat.config.number_offset[0]+"px;margin-top:"+mchat.config.number_offset[1]+'px;" id="JS_FC_number" onclick="mchat.openui(null,{click:\'number\'});return false;"></div>'),t+=mchat.config.html||"",mchat.isFlash&&(t+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="'+mchat.config.size_main[0]+'" height="'+mchat.config.size_main[1]+'"><param name="movie" value="'+mchat.config.background_main[0]+'"><param name="quality" value="high"><param name="allowScriptAccess" value="always" /><param name="wmode" value="transparent"><embed wmode="transparent" src="'+mchat.config.background_main[0]+'" width="'+mchat.config.size_main[0]+'" height="'+mchat.config.size_main[1]+'" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" allowScriptAccess="always" type="application/x-shockwave-flash"></embed></object>'),mchat.dom1.innerHTML=t,mchat.dom2=document.createElement("div"),mchat.dom2.setAttribute("id","Fchat2"),mchat.dom2.className="FC_hide",mchat.config.number2_offset&&mchat.config.number2_offset.length&&(mchat.dom2.innerHTML='<div class="FC_btns FC_number" style="margin-left:'+mchat.config.number2_offset[0]+"px;margin-top:"+mchat.config.number2_offset[1]+'px;" id="JS_FC_number2"></div>'),mchat.dom2.onclick=function(){mchat.show()},mchat.msgBox=document.createElement("div"),mchat.msgBox.setAttribute("id","FchatMsg"),mchat.potentialMsgBox=document.createElement("div"),mchat.potentialMsgBox.setAttribute("id","FchatPoMsg"),document.body.appendChild(mchat.dom1),document.body.appendChild(mchat.dom2),document.body.appendChild(mchat.msgBox),document.body.appendChild(mchat.potentialMsgBox),mchat.domExpr=$("#JS_slideChat_expr_box_x"),mchat.domNum=$("#JS_FC_number"),mchat.domNum2=$("#JS_FC_number2");mchat.d},mchat.hide=function(){mchat.dom1&&(mchat.dom1.className="FC_hide"),mchat.dom2&&(mchat.dom2.className=""),mchat.msgBox&&(mchat.msgBox.className="FC_min_msg"),mchat.potentialMsgBox&&(mchat.potentialMsgBox.className="FC_min_pomsg")},mchat.show=function(){mchat.dom1&&(mchat.dom1.className=""),mchat.dom2&&(mchat.dom2.className="FC_hide"),mchat.showCloud()},mchat.remove=function(){mchat.dom1&&(mchat.dom1.style.display="none"),mchat.dom2&&(mchat.dom2.style.display="none"),mchat.hideCloud()},mchat.reInit=function(){mchat.dom1&&(mchat.dom1.style.display=""),mchat.dom2&&(mchat.dom2.style.display=""),mchat.cloudClosed=!1,mchat.showCloud(),mchat.init(!0)},mchat.showSmsList=function(){var t={click:"聊天右漂浮框",postionCode:"mll_xuanfu"};mchat.config.potentialMsg&&(t.click="详情页_潜在用户"),$.codeSms(!1,t)},mchat.openQWG=function(t){if(window._ana&&window._ana.push(["trackEvent","QWGchat","click"]),!mchat.QWGbox){if(mchat.QWGData=t||{},mchat.QWGData.mobile=mchat.QWGData.mobile||$.cookie("mchat_qwg"),mchat.QWGData.mobile,!0)return void mchat.openui("qwg",mchat.QWGData);var e='<div><div style="font-size:16px;font-weight:bold;color:#333;font-family:微软雅黑">如您尚未提交设计申请，请 <a href="/quanwugou/qwgapply/" target="_blank" style="color:#f60;text-decoration:underline">立即提交</a></div><div style="color:#333;padding-bottom:10px;">已经提交过了？请输入手机号</div><div ><input id="JS_mchat_qwg_phone" style="padding:5px 5px;height:16px;line-height:16px;border:1px solid #ddd;border-radius:1px;color:#999" value="请输入手机号" onfocus="if(this.value==\'请输入手机号\')this.value=\'\'" onblur="if(this.value==\'\')this.value=\'请输入手机号\'" onkeypress="(function(e){e=e||window.event;if(e.keyCode==13){mchat.checkQWG();}})()" />&emsp;<input type="button" style="height:28px;width:88px;cursor:pointer;background:#d3023d;border:1px solid #c9033b;border-radius:2px;color:#fff;" value="咨询设计师" onclick="mchat.checkQWG();" /></div><div id="JS_mchat_qwg_msg" style="color:#f00;line-height:18px;padding-top:10px;padding-left:5px;">&ensp;</div></div>';$.alert(e),mchat.QWGbox=$("#"+$.lightBoxId),mchat.QWGbox.find("div.in").width("420px"),mchat.QWGbox.find("td.icons_td").css({"vertical-align":"top","padding-top":"5px"}),mchat.QWGbox.find("div.btns").hide()}},mchat.checkQWG=function(t){if(!mchat.checkQWG.lock)if(t=t||$("#JS_mchat_qwg_phone").val(),/1\d{10}/.test(t)){mchat.checkQWG.lock=!0;var e=612,o=512;mchat.isOpen=window.open("about:blank","MLL_CHAT","width="+e+",height="+o+",toolbar=no, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no ,left="+(screen.width-e)/2+",top="+(screen.height-o)/2),$.ajax({url:"/mll_api/api/generalRule?rulename=QWG_HSV1_AllhouseMobile&param=%7B%22mobile%22%3A%22"+t+"%22%7D&needAll=1&isJson=0&dbLang=1",dataType:"json",success:function(e){e&&e[0]?($.closeLightBox(),delete mchat.QWGbox,mchat.QWGData.mobile=t,window._ana&&window._ana.push(["trackEvent","QWGchat","success",t]),mchat.openui("qwg",mchat.QWGData,mchat.isOpen),$.cookie("mchat_qwg",t,{domain:"meilele.com"})):($("#JS_mchat_qwg_msg").html('您还未提交设计申请，请 <a href="/quanwugou/qwgapply/" target="_blank" style="text-decoration:underline;color:#f00">立即提交</a>'),mchat.isOpen.close()),mchat.checkQWG.lock=!1},error:function(){$("#JS_mchat_qwg_msg").html("查询失败，请稍候再试。"),mchat.checkQWG.lock=!1,mchat.isOpen.close()}})}else $("#JS_mchat_qwg_msg").html("请输入正确手机号")},mchat.openui=function(t,e,o,n){t=t||mchat.openuiType||!1,e=e||mchat.openuiData||{click:"slide"},e=e||{},t=t.toString();var c=$.cookie("MC_open")||"",a=mchat.host+"/mchat/";if(open_width=662,open_height=512,"qwg"==t.toLowerCase()&&(open_width=662,open_height=512,e.shopName="设计师",e.shopId="-1",a+="design.html"),mchat.msgBox&&4!=$(mchat.msgBox).find("#JS_msg_title").attr("msgType")&&mchat.hideCloud(),!mchat.lock){t&&(e.type=t),e.href=location.href;var i=[];if(1==$.cookie("meilele_login")&&$.cookie("ECS[username]")&&(e.user=$.cookie("ECS[username]")),mchat.config&&"undefined"!=typeof mchat.config.welcomeAd&&(e.welcomeAd=mchat.config.welcomeAd),window._chatInitData)for(var m in _chatInitData)e[m]=_chatInitData[m];for(var m in e)i.push(m+"="+encodeURIComponent(e[m]));a+="?"+(new Date).getTime().toString(36)+"#"+i.join("&"),o?o.location.href=a:mchat.isOpen&&!mchat.isOpen.closed?mchat.isOpen.focus():"closed"==c?($.cookie("MC_open","",{expires:-1,domain:"meilele.com"}),mchat.openui(t,e,o,n)):"openerCall"==c?($.cookie("MC_open","",{expires:-1,domain:"meilele.com"}),mchat.openui(t,e,o,n)):c?($.cookie("MC_open","openerCall",{domain:"meilele.com"}),mchat.lock=!0,setTimeout(function(){mchat.lock=!1},2e3)):(window._gaq=window._gaq||[],_gaq.push(["_trackEvent","chatClick",location.href,e.click]),window._ana=window._ana||[],n?_ana.push(["trackEvent","chatClick",location.href,e.click,n.type,n.content]):_ana.push(["trackEvent","chatClick",location.href,e.click]),mchat.isOpen=window.open(a,"MLL_CHAT","width="+open_width+",height="+open_height+",toolbar=no, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no ,left="+(screen.width-open_width)/2+",top="+(screen.height-open_height)/2)),mchat.domNum&&mchat.domNum.hide(),mchat.domNum2&&mchat.domNum2.hide()}},mchat.loopMsg=function(){mchat.lastEventTime!=mchat.lastLoopTime?("closed"==$.cookie("MC_open")&&$.cookie("jid")?$.cookie("MC_connCreated")&&$.cookie("MC_connCreated")===connection.connCreatedId?(!connection.onConnectionError||connection.onConnectionError<3)&&(connection.conn&&connection.conn.connected||connection.init()):$.cookie("MC_connCreated")&&"0"!=$.cookie("MC_connCreated")||(connection.connCreatedId=(new Date).getTime().toString(36)+"_"+Math.random().toString(36).replace(/^0\./,""),$.cookie("MC_connCreated",connection.connCreatedId),mchat.script?connection.init():(mchat.script="Strophe",$.ajax({url:"http://image.meilele.com/mchat/js/strophe.min.js",type:"get",dataType:"script",success:function(){connection.init()},error:function(){mchat.script=null,$.cookie("MC_connCreated","0")}}))):(mchat.initFAQ(),mchat.domExpr&&mchat.domExpr.hide()),mchat.lastLoopTime=mchat.lastEventTime):mchat.initFAQ(),mchat.setMsgNum(),$.cookie("MC_open")&&"closed"!=$.cookie("MC_open")&&mchat.hideCloud()},mchat.setMsgNum=function(){var t=$.cookie("MC_lastMID")||"0,0,0,1,"+$.cookie("connectedCusId"),e=t.split(",");e[0]=parseInt(e[0])||0,e[1]=parseInt(e[1])||0,e[2]=parseInt(e[2])||0;var o=e[0]-e[1]+e[2];if(mchat.domNum&&mchat.domNum.length)if(o>0){o>9?(mchat.domNum.addClass("FC_number2"),mchat.domNum2.addClass("FC_number2")):(mchat.domNum.removeClass("FC_number2"),mchat.domNum2.removeClass("FC_number2")),mchat.domNum.html(o).show(),mchat.domNum2.html(o).show();var n=decodeURIComponent($.cookie("MC_lastMsgContent")||"");n.length&&(n=n.length>15?n.substr(0,15)+"...":n,mchat.msgBox.innerHTML=mchat.createCloudHTML("有新消息！","<a href=\"javascript:;\" onclick=\"mchat.openui(mchat.openuiType||false,mchat.openuiData||{click:'message'},false,{type:'新消息',content:'"+o+"'});return false;\">"+n+"</a>",{type:3}),mchat.showCloud(3),"0"==e[3]&&(e[3]="1",e.length=5,$.cookie("MC_lastMID",e.join(","),{domain:"meilele.com"}),window.HTMLAudioElement?mchat.mp3?mchat.mp3.play():(mchat.mp3=document.createElement("audio"),mchat.mp3.setAttribute("hidden",!0),mchat.mp3.loop=!1,mchat.mp3.autostart=!0,mchat.mp3.src="http://image.meilele.com/images/zhuanti/upload/5_1371699795.mp3",mchat.mp3.play(),document.body.appendChild(mchat.mp3)):(mchat.mp3&&document.body.removeChild(mchat.mp3),mchat.mp3=document.createElement("embed"),mchat.mp3.setAttribute("hidden",!0),mchat.mp3.style.cssText="position:fixed;top:0",mchat.mp3.loop=!1,mchat.mp3.autostart=!0,mchat.mp3.src="http://image.meilele.com/images/zhuanti/upload/5_1371699795.mp3",document.body.appendChild(mchat.mp3))))}else mchat.domNum.hide(),mchat.domNum2.hide()},mchat.getMessageResponse=function(t){if(t&&4==t.type){if(4==$(mchat.msgBox).find("#JS_msg_title").attr("msgType"))return mchat.showCloud(),!1;mchat.msgBox.innerHTML=mchat.createCloudHTML("热点话题",t.data,{type:4})}},mchat.listenEvent=function(){$("body").on("mousemove",function(){mchat.lastEventTime=(new Date).getTime()})},mchat.beforeunload=function(){window.onunload=function(){$.cookie("MC_connCreated")&&$.cookie("MC_connCreated")===connection.connCreatedId&&(connection.conn&&connection.conn.connected&&connection.conn.disconnect(),$.cookie("MC_connCreated","0"))}},mchat.init=function(t){if(mchat.beforeunload(),mchat.cloudClosed=!1,mchat.head=document.getElementsByTagName("head")[0],t||(mchat.initCss(),mchat.insertDom()),mchat.not_show)mchat.remove();else{mchat.listenEvent();var e=$.cookie("needPayBonus"),o=!0;mchat.config.cloud_text&&(mchat.msgBox.innerHTML=mchat.createCloudHTML("有新消息！","<a href=\"javascript:;\" onclick=\"mchat.openui(mchat.openuiType||false,mchat.openuiData||{click:'message'},false,{type:'初始广告',content:'"+mchat.config.cloud_text+"'});return false;\">"+mchat.config.cloud_text+"</a>",{type:1}),mchat.showCloud(),o=!1),!mchat.hasInit&&/^\/category-.*\/goods-\d+/.test(location.pathname)&&(mchat.hasInit=!0,mchat.initPotential()),setTimeout(function(){mchat.hideCloud(),e&&(mchat.queue.add({level:2,immediate:!0,callback:function(){mchat.msgBox.innerHTML=mchat.createCloudHTML("有新消息！",'<a href="/user/?act=order_list" target="blank">您有未支付的红包！</a>',{type:2}),mchat.showCloud()}}),o=!1),mchat.config.cloud_text&&!e&&(o=!0),mchat.queue.add({level:999,immediate:o,callback:function(){mchat.loopMsg()}}),mchat.queue.start()},o?0:1e3*mchat.config.cloud_time||15e3)}(mchat.initHide||/ipad/.test(navigator.userAgent.toLowerCase()))&&mchat.hide()},mchat.initPotential=function(){window._ana=window._ana||[],window._gaq=window._gaq||[],$.ajax({url:"/dubbo_api/escommon/query/sendMsg?pageUrl="+encodeURIComponent(location.href),type:"get",dataType:"json",success:function(t){"0"==t.error&&t.result&&0!=t.result&&(mchat.config.potentialMsg={pCity:$.cookie("region_name")||"全国",pExprNum:t.result},$("#FchatPoMsg").html(mchat.createPotentialCloudHTML()),$("#FchatPoMsg").show(),$("#FchatPoMsg .expr-msg-close").click(function(){return $("#FchatPoMsg").hide(),!1}),$("#FchatPoMsg").click(function(){return mchat.showSmsList(),!1}))}})},mchat.initFAQ=function(){function t(t,e){var o=e,n=o.find("li"),c=n.length;return!(c<3)&&void setInterval(function(){n=o.find("li");var t=n.eq(0),e=n.last();t.animate({height:"0"},300,function(o){e.after(t.css({height:e.css("height")}))})},3e3)}return!(document.domain.indexOf("lejj")>=0||mchat.initFAQ.reqCount<=0)&&(4!=$(mchat.msgBox).find("#JS_msg_title").attr("msgType")&&(mchat.initFAQ.faqData?(mchat.getMessageResponse(mchat.initFAQ.faqData),new t($("#JS_msg_content"),$("#JS_faq_list")),mchat.showCloud(),!1):mchat.config.chat_faq&&0!=mchat.config.chat_faq.length?void $.ajax({url:"/mll_api/api/chat_window",type:"GET",dataType:"json",cache:!0,data:{id:encodeURIComponent(mchat.config.chat_faq.join("b"))||"",type:4},success:function(e){e&&e.data&&e.data.length?(mchat.getMessageResponse(e),new t($("#JS_msg_content"),$("#JS_faq_list")),mchat.initFAQ.faqData=e,mchat.showCloud(),mchat.initFAQ.reqCount=0):(mchat.hideCloud(),mchat.initFAQ.reqCount--)},error:function(t){mchat.hideCloud(),mchat.initFAQ.reqCount--}}):(mchat.initFAQ.reqCount=0,!1)))},mchat.initFAQ.reqCount=1,mchat.createCloudHTML=function(t,e,o){var n='<h3 msgType="'+o.type+'" class="msg_title" id="JS_msg_title">'+(4==o.type?'<a href="javascript:void(0)" class="close_btn" onclick="mchat.hideCloud();mchat.cloudClosed = true;return false;">×</a>':"")+'$TITLE</h3><div class="msg_content" id="JS_msg_content">$MSG</div>',c='<span class="triangle triangle_out"></span><span class="triangle triangle_in"></span>',a=Object.prototype.toString.call(e);switch(n=n.replace(/\$TITLE/g,t||"有新消息！"),a){case"[object String]":n=decodeURIComponent(n.replace(/\$MSG/g,e||"有新消息!"));break;case"[object Array]":for(var i='<ul class="faq_list" id="JS_faq_list">',m="",s=0,h=e.length;s<h;s++)m+='<li class="faq_item"><a title="'+decodeURIComponent(e[s].qes||"")+'" style="font-weight:normal;font-size:12px;color:#333" href="javascript:void(0);" onclick="mchat.openui(mchat.openuiType||false,{click:\'message\',faq:\''+decodeURIComponent(e[s].qes||"").replace(/\r|\n/g,"")+"'},false,{type:'常见问题',content:'"+decodeURIComponent(e[s].qes||"")+"'});return false;\">"+decodeURIComponent(e[s].qes||"")+"</a></li>";i+=m+"</ul>",n=n.replace(/\$MSG/g,i);break;case"[object Object]":}return n+c},mchat.createPotentialCloudHTML=function(){var t=mchat.config.potentialMsg,e='<div class="msg_content" id="JS_pomsg_content">'+t.pCity+'共<span class="red" style="font-weight:bold;">'+t.pExprNum+'</span>家体验馆<span class="red" style="display:block;">到店看实物</span></div><span class="triangle triangle_out"></span><span class="triangle triangle_in"></span><a class="expr-msg-close">×</a>';return e},mchat.hideCloud=function(t){t&&(mchat.msgBox.innerHTML=""),mchat.msgBox.style.display="none"},mchat.showCloud=function(t){return mchat.config&&1==mchat.config.show_cloud?(mchat.hideCloud(),mchat.cloudClosed=!0,!1):(mchat.config.potentialMsg&&(mchat.potentialMsgBox.className=""),!!mchat.msgBox.innerHTML&&(mchat.isOpen&&!mchat.isOpen.closed||(mchat.cloudClosed?3==t?mchat.msgBox.style.display="block":mchat.msgBox.style.display="none":mchat.msgBox.style.display="block"),void(mchat.msgBox.className="")))},mchat.queue=window.mchat.queue||[],mchat.queue.add=function(t){return(!t.immediate||(t.callback&&t.callback(),999==t.level))&&(this.push(t),void Array.prototype.sort.call(this,function(t,e){return t.level-e.level}))},mchat.queue.clear=function(){this.splice(0,this.length)},mchat.queue.start=function(){mchat.loopQueueTimmer=setInterval(function(){if(0==mchat.queue.length)return clearInterval(mchat.loopQueueTimmer),!1;for(var t=0,e=mchat.queue.length;t<e;t++){var o=mchat.queue[t];if(999!=o.level){o.callback&&o.callback(),mchat.queue.shift();break}o.callback&&o.callback()}},5e3)},mchat.init(),window.connection={BOSH_SERVICE:isSuppWebsocket()?mchat.host.replace("http","ws")+":7070/ws/":"/http-bind/",HOST_FIX:"@"+mchat.host.replace("http://",""),CONNECT_WAIT:50,initConnection:!0,rawPrint:function(t){this.configlog&&console&&console.log("LOG:"+t)},init:function(){connection.conn=connection.conn||new Strophe.Connection(connection.BOSH_SERVICE),connection.conn.rawInput=function(t){connection.rawPrint("RECV: "+t.toString())},connection.conn.rawOutput=function(t){connection.rawPrint("SEND: "+t.toString())},connection.conn.connect(Strophe.getNodeFromJid($.cookie("jid")),"",connection.onConnection,connection.CONNECT_WAIT),connection.connCookiecheck()},onConnection:function(t){t==Strophe.Status.CONNECTING||(t==Strophe.Status.CONNFAIL?(connection.onConnectionError=connection.onConnectionError||0,connection.onConnectionError++,connection.connectionError()):t==Strophe.Status.DISCONNECTING||(t==Strophe.Status.DISCONNECTED?(connection.connectionError(),connection.initConnection=!0):t==Strophe.Status.CONNECTED&&connection.connectionSuccess()))},connectionSuccess:function(){$.cookie("jid",connection.conn.jid),connection.conn.send($pres().tree()),connection.initConnection&&(connection.conn.addHandler(connection.onMessage,null,"message",null,null,null),connection.conn.addHandler(connection.getSystemSay,"urn:meilele:iq:kfMessage","iq",null,null,null),connection.initConnection=!1)},connectionError:function(){connection.onConnectionError&&connection.onConnectionError>=3&&$.cookie("MC_connCreated","0")},onMessage:function(t){var e=t.getAttribute("type"),o=t.getElementsByTagName("body"),n=Strophe.getBareJidFromJid(t.getAttribute("from"));if("chat"==e&&o.length>0){for(var c=t.getElementsByTagName("property"),a={},i=0;i<c.length;i++){var m=c.item(i);if(1==m.nodeType&&m.hasChildNodes()){var s=m.childNodes.item(0).textContent||m.childNodes.item(0).text,h=m.childNodes.item(1).textContent||m.childNodes.item(1).text;a[s]=h}}var l=parseInt(a.SecurityMsgIndex||1),r=Strophe.getText(t.getElementsByTagName("body")[0]),d=$.cookie("MC_lastMID")||"0,0,0,1,"+void 0,p=d.split(",");p[4]!=n?(p[2]=parseInt(p[2])+parseInt(p[0])-parseInt(p[1]),p[3]="0",p[0]=l,p[1]=l-1,p[4]=n):(p[0]=l,p[3]="0"),p.length=5,$.cookie("MC_lastMID",p.join(","),{domain:"meilele.com"}),$.cookie("MC_lastMsgContent",encodeURIComponent(r),{domain:"meilele.com"})}else mchat.initFAQ();return!0},getSystemSay:function(t){var e=(t.getAttribute("type"),t.getAttribute("from")),o=Strophe.getText(t.getElementsByTagName("msgType")[0]),n=(Strophe.getText(t.getElementsByTagName("content")[0]),t.getElementsByTagName("message")[0]);return ns=n?n.getAttribute("xmlns"):"","onlineStatus"==o&&null!=connection.conn&&connection.sendSystemSay("result",ns,"onlineStatus","客户当前在线",e),!0},sendSystemSay:function(t,e,o,n,c,a){if(e=e||"urn:meilele:iq:customerMessage",null!=connection.conn){var i=Math.random(),m=Strophe.getNodeFromJid(connection.conn.jid),s={type:t,to:c||$.cookie("connectedCusId")};"get"==t?s.id=(m+"_"+i).replace(".",""):"result"==t&&a&&(s.id=a);var h=$iq(s).c("message",{xmlns:e}).c("msgType",o).up().c("content",n);connection.conn.sendIQ(h)}},connCookiecheck:function(){connection.cookieCheck&&clearInterval(connection.cookieCheck),connection.cookieCheck=setInterval(function(){$.cookie("MC_open")&&"closed"!=$.cookie("MC_open")&&(connection.conn&&connection.conn.connected&&connection.conn.disconnect(),clearInterval(connection.cookieCheck))},1e3)}};
/*duanzheng*247113:2016-12-29 17:15:32*/